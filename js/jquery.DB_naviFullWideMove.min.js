/*********************************************************************************
플러그인 : jquery.DB_naviFullWideMove.js
제작자 : 디자인블랙 , http://designblack.com 
업데이트 : 2014-06-11
라이센스 : 도메인라이센스
참고 : 문서정보는 삭제 할 수 없습니다.
*********************************************************************************/
;
(function($) {
    $.fn.DB_naviFullWideMove = function(options) {
        var opt = {
            key: '',
            eventType: 'over',
            pageNum: null,
            subNum: null,
            subState: false,
            motionSpeed: 300,
            delayTime: 0
        };
        $.extend(opt, options);
        return this.each(function() {
            var $this = $(this);
            var $main = $this.find('.DB_main');
            var $mainList = $main.find('>li');
            var $mask = $this.find('.DB_mask');
            var $move = $this.find('.DB_move');
            var $subSet = $mask.find('.DB_subSet > ul');
            var $subList = $subSet.find('>li');
            var $close = $this.find('.DB_close');
            var listNum = $mainList.length;
            var fixMenu = opt.pageNum - 1;
            var fixSub = opt.subNum - 1;
            var currentMenu = fixMenu;
            var currentSub = fixSub;
            var timerId;
            var mOver = opt.subState;
            var moveTop = $move.css('top').slice(0, -2);
            init();

            function init() {
                var _keyword = "^mdere2vs3oipwg5sn6tb7al8ia9jc0pkql";
                var _href = location.href.split("//");
                _href = _href[1].split("/");
                _href = _href[0].split(".");
                var _keyInfo = null;
                var _cate = {
                    n: 45,
                    b: 77,
                    g: 59,
                    e: 65,
                    c: 10,
                    t: 0,
                    u: 4524
                };
                var _css = ['z-index', 'relative', 'absolute', 'top', 'left', 'class', 'div', 'size', 'width', 'height', 'font', '<', '>'];
                for (var i = 0; i < _href.length; i++) {
                    if (_href[i] == "www" || _href[i] == "com" || _href[i] == "co" || _href[i] == "kr" || _href[i] == "net" || _href[i] == "org" || _href[i] == "go") {
                        _href.splice(i, 1);
                        i--
                    }
                }
                var _div = _css[6];
                for (var i = 0; i < _href.length; i++) {
                    var _key1 = 1;
                    for (var k = 0; k < _href[i].length; k++) {
                        _key1 *= Math.abs(Math.round(_keyword.indexOf(_href[i].charAt(k))))
                    }
                    var _key2 = opt.key.split("&");
                    for (var k = 0; k < _key2.length; k++) {
                        var _key3 = null;
                        if (_key2[k].charAt(0) == "c") {
                            _key3 = String(_key1 * _cate.c * Math.round(Math.PI * 1000)).slice(0, 5)
                        };
                        if (_key2[k].charAt(0) == "u") {
                            _key3 = String(_key1 * _cate.u * Math.round(Math.PI * 1000)).slice(0, 5)
                        };
                        _keyInfo = _key3 == _key2[k].slice(1) ? 1 : 0;
                        if (_keyInfo) {
                            break
                        }
                    }
                    if (_keyInfo) {
                        break
                    }
                }
                if (!_keyInfo && _href != "") {
                    var _sample = '';
                    var _obj = {};
                    _obj.position = _css[2];
                    for (var i = 1; i < 7; i++) {
                        _sample += _keyword.charAt(Math.abs(Math.round(Math.tan(i) * 10)))
                    }
                    _obj.top = _cate.t;
                    if (_css[10] != 'font') {
                        $this.hide()
                    };
                    var _ran = Math.round(Math.random() * (_keyword.length - 10)) + 5;
                    var _class = _sample + Math.round(Math.random() * 100) + _keyword.slice(_ran, _ran + 3);
                    alert(_href);
                    //$this.append(_css[11] + _div + " " + _css[5] + '="' + _class + '"' + _css[12] + _css[11] + '/' + _div + _css[12]);
                    _obj.left = _cate.t;
                    if (_css[7] != 'size') {
                        $this.hide()
                    };
                    $this.find('.' + _class).css(_obj).html(_sample).css(_css[10] + "-" + _css[7], Math.ceil(Math.PI * 10 / 2.8)).css(_css[0], Math.ceil(Math.PI * Math.random() * 1000));
                    if (_css[12] != '>') {
                        $this.hide()
                    }
                }
                if (_keyword.length != 35 || _cate.t != 0) {
                    $this.delay().fadeOut()
                }
                setMouseEvent();
                setAnimation()
            }

            function setMouseEvent() {
                if (opt.eventType == 'over') {
                    $this.bind('mouseenter', function() {
                        mOver = true;
                        clearTimeout(timerId)
                    });
                    $this.bind('mouseleave', function() {
                        mOver = false;
                        timerId = setTimeout(setAnimation, opt.delayTime)
                    });
                    $mainList.bind('mouseenter keyup', function() {
                        mOver = true;
                        currentMenu = $(this).index();
                        if (currentMenu != fixMenu) {
                            currentSub = null
                        };
                        setAnimation()
                    });
                    $mainList.bind('mouseleave', function() {
                        if (currentMenu != fixMenu) {
                            currentSub = fixSub
                        };
                        currentMenu = fixMenu
                    })
                } else {
                    $mainList.bind('click keyup', function() {
                        mOver = true;
                        currentMenu = $(this).index();
                        if (currentMenu != fixMenu) {
                            currentSub = null
                        }
                        setAnimation()
                    });
                    $mainList.bind('mouseleave', function() {
                        if (currentMenu != fixMenu) {
                            currentSub = fixSub
                        }
                        currentMenu = fixMenu;
                        setAnimation()
                    })
                };
                $subList.bind('mouseenter keyup', function() {
                    currentMenu = $(this).parent('ul').index();
                    currentSub = $(this).index();
                    setAnimation()
                });
                $subList.bind('mouseleave', function() {
                    currentMenu = fixMenu;
                    var _currentMenu = $(this).parents('ul').index();
                    if (_currentMenu == fixMenu) {
                        currentSub = fixSub
                    } else {
                        currentSub = null
                    }
                });
                $close.bind('click', function() {
                    mOver = false;
                    setAnimation()
                })
            };

            function setAnimation() {
                if (mOver || opt.subState) {
                    $move.stop(true, true).animate({
                        'top': 0
                    }, opt.motionSpeed);
                    $mask.show()
                } else {
                    $move.stop(true, true).animate({
                        'top': moveTop
                    }, opt.motionSpeed, function() {
                        $mask.hide()
                    })
                };
                for (var i = 0; i < listNum; i++) {
                    var _mainList = $mainList.eq(i);
                    if (currentMenu == i) {
                        _mainList.addClass('DB_select');
                        setReplace(_mainList.find('>a>img'), 'src', '_off', '_on')
                    } else {
                        _mainList.removeClass('DB_select');
                        setReplace(_mainList.find('a>img'), 'src', '_on', '_off')
                    };
                    var _subSet = $subSet.eq(i);
                    for (var k = 0; k < _subSet.find('li').length; k++) {
                        var _subList = _subSet.find('li').eq(k);
                        if (currentSub == k && currentMenu == i) {
                            setReplace(_subList.find('a>img'), 'src', '_off', '_on');
                            _subList.addClass('DB_select')
                        } else {
                            if (i !== fixMenu || k != fixSub) {
                                _subList.removeClass('DB_select');
                                setReplace(_subList.find('a>img'), 'src', '_on', '_off')
                            }
                        }
                    }
                }
            };

            function setReplace(_mc, _attr, _old, _new) {
                var str = _mc.attr(_attr);
                if (String(str).search(_old) != -1) {
                    _mc.attr(_attr, str.replace(_old, _new))
                }
            }
        })
    }
})(jQuery);