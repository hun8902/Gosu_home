var currently_switching=!1;function switchin(switch_in,switch_out,options=null)
{currently_switching=!0
var settings={scrollTarget:'none',scrollDuration:500,outAnimation:'transition.slideLeftBigOut',inAnimation:'transition.slideRightBigIn',outSpeed:500,inSpeed:500,startFunc:null,endFunc:null};if(options!=null)
$.extend(settings,options);if(settings.startFunc)settings.startFunc();$(switch_out).velocity(settings.outAnimation,{duration:settings.outSpeed,complete:function(){if(settings.scrollTarget=='both'||settings.scrollTarget=='screen')
$('html, body').velocity('scroll',{duration:settings.scrollDuration,container:$(switch_in)});if((settings.scrollTarget=='both'||settings.scrollTarget=='body')&&$(window).scrollTop()>10)
{$('html, body').velocity('scroll',{duration:settings.scrollDuration,complete:function(){$(switch_in).velocity(settings.inAnimation,{duration:settings.inSpeed,complete:function(){currently_switching=!1;if(settings.endFunc)settings.endFunc()}})}})}
else $(switch_in).velocity(settings.inAnimation,{duration:settings.inSpeed,complete:function(){currently_switching=!1;if(settings.endFunc)settings.endFunc()}})}})}
var SwitchMenu=function(menu_selector,screens,ops=null)
{this.menu_selector=menu_selector;this.menu=$(this.menu_selector);this.screen_class=this.menu.prop('id')+'_screen';this.menu.addClass('switch_menu');this.settings={scrollTarget:'none',scrollDuration:500,outAnimation:'transition.slideLeftBigOut',inAnimation:'transition.slideRightBigIn',outSpeed:500,inSpeed:500};if(ops!=null)
$.extend(this.settings,ops);this.reset=function()
{switchin('#'+$('.'+this.screen_class).first().prop('id'),'.'+this.screen_class);this.menu.children('a').removeClass('selected');this.menu.children("a[href='"+'#'+$('.'+this.screen_class).first().prop('id')+"']").addClass('selected')}
this.init=function()
{var options=$(menu_selector+' a');this.menu.children('a').first().addClass('selected');this.menu.prop('data-curScreen',screens[0]);var screenMenuObject=this;$.each(screens,function(index,current_screen)
{if(current_screen!='skip'&&current_screen!=null)
{$(current_screen).addClass(screenMenuObject.screen_class);if(index>0)
$(current_screen).css('display','none');$(options[index]).on('click',function(e)
{e.preventDefault();e.stopPropagation();if($(current_screen).css('display')=='none')
{screenMenuObject.menu.prop('data-curScreen',current_screen);var pages=[];$('.switch_menu').each(function()
{pages.push($(this).prop('data-curScreen'))});history.pushState(pages,null,screenMenuObject.menu.prop('data-curScreen'));switchin(current_screen,'.'+screenMenuObject.screen_class,screenMenuObject.settings)}
screenMenuObject.menu.children('a').removeClass('selected');$(this).addClass('selected')})}})}
this.init()}
window.addEventListener('popstate',function(e){if(e.state)
{if(e.state)
set_state(e.state)}});function set_state(state)
{$('.switch_menu').each(function(index,value)
{if($(state[index]).css('display')=='none')
{if(state[index]!==null)
{switchin(state[index],'.'+$(this).prop('id')+'_screen');$(this).children('a').removeClass('selected');$(this).children("a[href='"+state[index]+"']").addClass('selected')}}})}